syntax = "proto3";

package dispatch.delivery_note.v1;

import "google/protobuf/timestamp.proto";
import "warehousing/stock/v1/stock_level.proto";

enum Status{
  UNSET = 0;
  CREATED = 1;
  DRAFT = 2;
  SCHEDULED = 3; //TODO: Confirm if a DN in a scheduled status holds the ordered goods
  PUBLISHED = 4; //TODO: Confirm the published status is still relevant
  PROCESSING = 5;
  CHANGE_REQUESTED = 6;
  DISPATCHED = 7;
  DELIVERING = 8;
  DELIVERED = 9;
  PAID = 10;
  SOLD_ON_CREDIT = 11;
  RESCHEDULED = 12;
  CANCELLED = 13;
  EXPIRED = 14;
}

enum FulfilmentStatus {
  ITEM_UNSET = 0;
  ITEM_PROCESSED = 1;
  ITEM_RESCHEDULED = 2;
  ITEM_CANCELLED = 3;
  ITEM_FULFILLED = 4;
}


message OrderItem {
  string item_code = 1;
  string item_name = 2;
  int32 ordered_quantity = 3;
  int32 dispatched_quantity = 4;
  int32 delivered_quantity = 5;
  double selling_price = 6;
  string item_group = 7;
  int32 quantity = 8;
  string stocking_unit = 9;
  string warehouse_id = 10;
  string uom = 11;
  string stocking_uom = 12;
  string item_description = 13;
  double item_price = 14;
  double valuation_rate = 15;
  double discount_amount = 16;
  string image_url= 17;
  FulfilmentStatus fulfilment_status = 18;
//  please confirm if use the import variable delivery_window or just the reference ?
  string delivery_window_id = 19;
}

message Location {
  string name = 1;
  string latitude = 2;
  string longitude = 3;
}

message DeliveryNote{
  string id = 1;
  string name = 2;
  string customer_name = 3;
  string company_name = 4;
  string currency = 5;
  string sales_partner = 6;
  google.protobuf.Timestamp creation_date = 7;
  string sale_order_id = 8;
  Status workflow_state = 9;
  google.protobuf.Timestamp created_at = 10;
  Location location = 11;
  double amount = 12;
  string territory_name = 13;
  repeated warehousing.stock.v1.StockLevel stock_level = 14 [deprecated = true];
  repeated OrderItem order_item = 15;
  bool on_trip = 16;
  string current_trip_code = 17;
  google.protobuf.Timestamp last_updated = 18;
  google.protobuf.Timestamp delivered_date = 19;
  google.protobuf.Timestamp dispatched_date = 20;
  repeated OrderItem original_order_items = 21;
  bool is_pre_karuru = 22;
}

//Payload to create a new Delivery Note
message PostDeliveryNoteRequest {
  string name = 1;
  string customer_name = 2;
  string company_name = 3;
  int32  currency = 4;
  string sales_partner = 5;
  google.protobuf.Timestamp creation_date = 6;
  string sale_order_id = 7;
  Status workflow_state = 8;
  repeated OrderItem order_item = 9;
  google.protobuf.Timestamp created_at = 10;
  Location location = 11;
  double amount = 12;
  string territory_name = 13;
  bool on_trip = 14;
  string current_trip_code = 15;
  google.protobuf.Timestamp delivered_date = 19;
  google.protobuf.Timestamp dispatched_date = 20;
  repeated OrderItem original_order_items = 21;
}

//Response from PostDeliveryNoteRequest
message PostDeliveryNoteResponse {
  int32 response_code = 1;
  string message = 2;
  DeliveryNote data = 3;
}

//Payload to fetch a Delivery Note
message GetDeliveryNoteRequest {
  string id = 1;
  string name = 2;
  Status workflow_state = 3;
  string territory_id = 4;
}

//Response from GetDeliveryNoteRequest
message GetDeliveryNoteResponse {
  int32 response_code = 1;
  string message = 2;
  DeliveryNote data = 3;
}

message FilterDeliveryNoteRequest {
  string name = 1;
  string customer_name = 2;
  string company_name = 3;
  string sales_partner = 4;
  google.protobuf.Timestamp creation_date = 5;
  string sale_order_id = 6;
  Status workflow_state = 7;
  string territory_name = 8;
  string territory_id = 9;
  int32 page_size = 10;
  int32 page_number = 11;
  google.protobuf.Timestamp to_date = 12;
  google.protobuf.Timestamp from_date = 13;
  google.protobuf.Timestamp delivered_date = 19;
  google.protobuf.Timestamp dispatched_date = 20;
  string current_trip_code = 21;
}

message FilterDeliveryNoteResponse {
  int32 response_code = 1;
  string message = 2;
  repeated DeliveryNote data = 3;
  int32 page_size = 4;
  int32 page_number = 5;
}

message TransitionDeliveryNoteRequest {
  string id = 1;
  string delivery_note_id = 2;
  string delivery_note_name = 3;
  Status workflow_state = 4;
  string reason = 5;
}

message TransitionDeliveryNoteResponse {
  int32 response_code = 1;
  string message = 2;
  DeliveryNote data = 3;
}

message RemoveDeliveryNoteItemRequest {
  string id = 1;
  string delivery_note_name = 2;
  string item_name = 3;
}

message RemoveDeliveryNoteItemResponse {
  int32 response_code = 1;
  string message = 2;
  DeliveryNote data = 3;
}

message UpdateDeliveryNoteItemRequest {
  string id = 1;
  string item_name = 2;
  string delivery_note_name = 3;
  int32 quantity = 4;
}

message UpdateDeliveryNoteItemResponse {
  int32 response_code = 1;
  string message = 2;
  DeliveryNote data = 3;
}

message TransitionOrderItemsRequest {
  string id = 1;
  string item_name = 2;
  string delivery_note_name = 3;
  FulfilmentStatus fulfilment_status = 4;
}

message TransitionOrderItemsResponse {
  int32 response_code = 1;
  string message = 2;
  DeliveryNote data = 3;
}

message CreatePaymentEntryRequest {
  string id = 1;
  string delivery_note_name = 2;
  string amount = 3;
}

message CreatePaymentEntryResponse {
  int32 response_code = 1;
  string message = 2;
}

//Service definition
service DeliveryNoteService {
  rpc PostDeliveryNote(PostDeliveryNoteRequest) returns (PostDeliveryNoteResponse) {}
  rpc GetDeliveryNote(GetDeliveryNoteRequest) returns (GetDeliveryNoteResponse) {}
  rpc FilterDeliveryNote(FilterDeliveryNoteRequest) returns (FilterDeliveryNoteResponse) {}
  rpc UpdateDeliveryNoteItem(UpdateDeliveryNoteItemRequest) returns (UpdateDeliveryNoteItemResponse) {}
  rpc RemoveDeliveryNoteItem(RemoveDeliveryNoteItemRequest) returns (RemoveDeliveryNoteItemResponse) {}
  rpc TransitionDeliveryNote(TransitionDeliveryNoteRequest) returns (TransitionDeliveryNoteResponse) {}
  rpc TransitionOrderItems(TransitionOrderItemsRequest) returns (TransitionOrderItemsResponse) {}
  rpc CreatePaymentEntry(CreatePaymentEntryRequest) returns (CreatePaymentEntryResponse) {}
}
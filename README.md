# Data Products

## Repository

The repository is primarily owned by that [data team](https://github.com/orgs/Kyosk-Digital/teams/data-team). They have central control of things like managing shared code, CI/CD actions etc. The rest of the teams are controlled via the codeowners file located in `.*github/CODEOWNERS`*  

## Directory Structure

The repository at the root level is arranged by the different squads we have in kyosk. 

```
.
├── ./bin (*protoc arch compile options*)
│   └── ./bin/scripts (central build scripts)
├── ./demo (*demo squad to showcase dir structure and buf operation*)
│   ├── ./demo/gen (*folder where all demo squads autogenerated scrips will be* )
│   │   └── ./demo/gen/java-src (*Root gradle project(manually created) autogenerated java files will be place in either data or testData submodules* )
│   │       ├── ./demo/gen/java-src/data (*gradle submodule with* *protoc files for data entity*)
│   │       │   └── ./demo/gen/java-src/data/src
│   │       ├── ./demo/gen/java-src/gradle
│   │       │   └── ./demo/gen/java-src/gradle/wrapper
│   │       └── ./demo/gen/java-src/testData (*gradle submodule with* *protoc files for test server/client. These are all files that end in _test.proto*)
│   │           └── ./demo/gen/java-src/testData/src 
│   └── ./demo/protos (*this is where .proto files are defined*)
│       ├── ./demo/protos/paymentapis (*a subdomain or demo*)
│       │   └── ./demo/protos/paymentapis/v1
│       └── ./demo/protos/petapis (*a subdomain or demo*)
│           └── ./demo/protos/petapis/pet
│               └── ./demo/protos/petapis/pet/v1
├── ./ibs  ( *IBS squad base dir*)
├── ./order_fulfillment ( *OF squad root dir*)
│   └── ./order_fulfillment/protos
├── ./payments ( *Payments squad root dir*)
│   └── ./payments/protos
├── ./retail_experience ( *RE squad root dir*)
│   └── ./retail_experience/protos
└── ./vas ( *VAS squad root dir*)
    └── ./vas/protos
```

- Operations
    
    Most operations (linting, breaking change checks ) must be run within the squad root directory using the below command
    
    ```bash
    # to perform lint checks
    buf lint
    
    #To check breaking changes against master 
    #NB the subdir should be your squad root dir
    buf breaking --against="../.git#branch=master,subdir=demo"
    
    #to generate source code
    ../bin/scripts/commands 
    ```
    
    - Source Code Generation
        
        the *buf.gen.yaml* files that control source code generation will be found under `bin/scripts`
        
        - generator binaries
        - Java
            - Directory Structure
            - Artifact Generation
                - grpc-generator
                    
                    the code will be found in the bin directory in root folder. you can find the generator from [maven](https://mvnrepository.com/artifact/io.grpc/protoc-gen-grpc-java/1.49.1) when you click on the files section. We have for both linux and mac(for local builds)
                    
                    - osx-aarch_64 (mac m1)
                    - linux-x86_64  ([github actions](https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#supported-runners-and-hardware-resources))
            - Artifact Publishing
- CI/CD
syntax = "proto3";
package payment_integrations.mpesa.v1;

import "google/protobuf/timestamp.proto";

//The matched status is used to define whether a transaction is used or not
enum MpesaStatus{
  //the mpesa code is maching
  PROCESSING = 0;

  // The mpesa code has been deposited into a Safaricoms wallet
  SAF_CREDITED = 2;
  
  // The mpesa code has been deposited into a customers wallet
  USER_CREDITED = 3;

  //If user initiated a cancellation request
  CANCELLED = 4;

  // Mostly for till transactions if we do not receive message from safcom within a specified window;
  EXPIRED = 5;

  // this is only applicable when we have credited safaricom but not credited a user
  REFUNDED = 6;

  // This is the status after the codes is deactivated
  INACTIVE = 7;
}


//The payment method to complete an Mpesa transaction
enum MpesaMethod{

  //The Till method
  TILL = 0;

  //Through initiating an STK
  STK = 1;
}


//Mpesa payment request (Mpesa service)
message MpesaDeposit{

  // this is the same as the mpesa code
  string id = 1;

  //The Mpesa code (transaction reference)
  string mpesa_code = 2;

  //a unique ID generated by system when a request has been done
  string payment_request_id = 3;

  //Kyosk Customer ID
  string customer_id = 4;

  //The phone number used to make a payment
  string msisdn = 5;

  //Kyosk Till number
  int32 till_number = 6;


  //The transaction amount
  int32 transaction_amount = 7;


  //Transaction Type
  string transaction_type = 9;

  //Payment Method
  MpesaMethod mpesa_method = 10;


  //The payment status i.e "SUCCESSFULL || FAILED"
  MpesaStatus status = 15;

  //metadata such as merchant request id, checkout request id, etc
  Metadata metadata = 16;

  //Time when Mpesa worflow was initiated. message from safcom arrived or when validation request was received, whichever came first
  google.protobuf.Timestamp initiation_time = 20;

  // Time when transaction was created on safaricom side
  google.protobuf.Timestamp transaction_time = 21;

  // Time when transaction was created on safaricom side
  google.protobuf.Timestamp verification_entry_time = 22;

  // Time when mpesa message arrived on our system from safcom
  google.protobuf.Timestamp safcom_msg_arrival_time = 23;

  google.protobuf.Timestamp completion_time = 24;

  EntryMode entry_mode = 27;


  // customer type helps evaluate short-code to use
  CustomerType customer_type =28;

}

enum EntryMode{

  // This is when safcom sends us the message 
  CALLBACK = 0;

  // This is when we poll safcom and if we do not have the message we create it
  API_POLL = 1;

  // This is when the safcom message is uploaded via CSV
  CSV_UPLOAD = 2;

}

enum CustomerType {
  RETAILERS = 0;
  FARM = 1;
  COMMERCIAL_KITCHENS = 2;
  FRESH_RETAIL = 3;
  WHOLESALERS = 4;
  KYOSK_TEAM = 5;
}

//This is additional information received from safaricom
message Metadata{

  string merchant_request_id = 1;

  string checkout_request_id = 2;
}